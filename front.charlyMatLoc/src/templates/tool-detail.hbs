<div class="container tool-detail-page">
    {{#if error}}
        <div class="alert alert-danger">
            <p>{{error}}</p>
            <a href="#" data-page="catalog" class="btn btn-primary">Retour au catalogue</a>
        </div>
    {{else}}
    {{#with tool}}
    <div class="tool-detail-header">
        <a href="#" data-page="catalog" class="btn btn-primary">&larr; Retour au catalogue</a>
    </div>

    <div class="tool-detail-content">
        <div class="tool-info">
            <h1 class="tool-title">{{name}}</h1>
            <div class="tool-category">{{category_name}}</div>
            <div class="tool-price">Tarif de location : {{#if
                pricing_tiers.[0]}}{{pricing_tiers.[0].price_per_day}}€{{else}}50€{{/if}}</div>
            <hr>
            <div class="tool-description">
                <p>{{description}}</p>
                <p class="tool-stock">
                    <strong>Stock disponible :</strong>
                    <span data-tool-stock>{{stock}}</span>
                </p>
            </div>

            {{#if pricing_tiers}}
            <div class="pricing-details">
                <h3>Tarifs de location</h3>
                <ul class="pricing-list">
                    {{#each pricing_tiers}}
                    <li>
                        <strong>{{price_per_day}} € / jour</strong>
                        (pour {{min_duration_days}}{{#if max_duration_days}}-{{max_duration_days}} jour(s){{else}}+
                        jours{{/if}})
                    </li>
                    {{/each}}
                </ul>
            </div>
            {{/if}}
            
        </div>

        <div class="tool-image-container">
            <div class="tool-image">
                <img src="{{image_url}}" alt="Image de {{name}}">
            </div>
            <div class="add-to-cart-card">
                <h3>Réserver cet outil</h3>
                <form class="add-to-cart-form" data-tool-id="{{tool_id}}">
                    <div class="form-group">
                        <label for="start-date-{{tool_id}}">Date de début</label>
                        <input
                            type="date"
                            id="start-date-{{tool_id}}"
                            name="start_date"
                            value="{{../defaultStartDate}}"
                            min="{{../defaultStartDate}}"
                            required
                            {{#unless ../isAuthenticated}}disabled{{/unless}}
                        >
                    </div>
                    <div class="form-group">
                        <label for="end-date-{{tool_id}}">Date de fin</label>
                        <input
                            type="date"
                            id="end-date-{{tool_id}}"
                            name="end_date"
                            value="{{../defaultEndDate}}"
                            min="{{../defaultStartDate}}"
                            required
                            {{#unless ../isAuthenticated}}disabled{{/unless}}
                        >
                    </div>
                    <div class="form-group">
                        <label for="quantity-{{tool_id}}">Quantité</label>
                        <input
                            type="number"
                            id="quantity-{{tool_id}}"
                            name="quantity"
                            min="1"
                            max="{{stock}}"
                            value="1"
                            data-stock-input
                            {{#unless ../isAuthenticated}}disabled{{/unless}}
                        >
                    </div>
                    <button type="submit" class="btn btn-primary btn-block" {{#unless ../isAuthenticated}}disabled{{/unless}}>
                        Ajouter au panier
                    </button>
                </form>
                {{#unless ../isAuthenticated}}
                    <p class="login-hint">Connectez-vous pour ajouter des articles à votre panier.</p>
                {{/unless}}
            </div>
        </div>
    </div>
    {{/with}}
    {{/if}}
</div>
